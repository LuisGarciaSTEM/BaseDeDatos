DROP SCHEMA IF EXISTS EJERCICIO_7;
CREATE SCHEMA EJERCICIO_7;
USE EJERCICIO_7;

# RESTRICCIONES: 
# 	- DESCIPCION Y NOMBRE COMUN NO PUEDEN SER NULOS.
#   - EL CLIMA POR DEFECTO ES "SOLEADO".
#   - EL TIEMPO DEL RECORRIDO DEBE SER MAYOR DE 30 MINUTOS.
#   - LA LONGITUD DEL RECORRIDO NO PUEDE SER NEGATIVA.
#   - EL INDICE DE VULNERABILIDAD ES UN NUMERO ENTRE 0 Y 10.
        

# ESPECIE (NOMBRE_CIENTIFICO, DESCRIPCION, FOTO)
CREATE TABLE ESPECIE (
	NOMBRE_CIENTIFICO VARCHAR(50) PRIMARY KEY,
    DESCIPCION MEDIUMTEXT NOT NULL,
    FOTO MEDIUMBLOB
);

INSERT INTO ESPECIE VALUES 
("OSO POLAR", "ES UN OSO GIGANTE QUE VIVE EN EL POLO NORTE", NULL);

# ESPECIE_TIENE_NOMBRE_COMUN (NOMBRE_CIENTIFICO, NOMBRE_COMUN)
CREATE TABLE ESPECIE_TIENE_NOMBRE_COMUN(
	NOMBRE_CIENTIFICO VARCHAR (50),
    NOMBRE_COMUN VARCHAR (50) NOT NULL,
	
    PRIMARY KEY (NOMBRE_CIENTIFICO, NOMBRE_COMUN),
    
    FOREIGN KEY (NOMBRE_CIENTIFICO) REFERENCES ESPECIE(NOMBRE_CIENTIFICO)        
);


# RECORRIDO (CODIGO_RECORRIDO, LONGITUD, TIEMPO, MAX_VISITANTES)
CREATE TABLE RECORRIDO(
	CODIGO_RECORRIDO INT PRIMARY KEY AUTO_INCREMENT,
    LONGITUD DECIMAL (5,2),
    TIEMPO TIME,
    MAX_VISITANTES MEDIUMINT,
    
    CONSTRAINT TIEMPO_MAYOR_30 CHECK (TIEMPO > "00:30:00"),
	CONSTRAINT LONGITUD_POSITIVA CHECK (LONGITUD > 0)
);


# HABITAT (NOMBRE_HABITAT, CLIMA, VEGETACION, CODIGO_RECORRIDO)
CREATE TABLE HABITAT (
	NOMBRE_HABITAT VARCHAR (50) PRIMARY KEY,
    CLIMA VARCHAR (50) DEFAULT "SOLEADO",
    VEGETACION VARCHAR (50),
    CODIGO_RECORRIDO INT,
    
    FOREIGN KEY (CODIGO_RECORRIDO) REFERENCES RECORRIDO(CODIGO_RECORRIDO)
);

INSERT INTO HABITAT VALUES 
("ESPAÑA", "SOLEADO", "POCA", NULL);

# ESPECIE_VIVE_HABITAT (NOMBRE_CIENTIFICO, NOMBRE_HABITAT, INDICE_VULNERABILIDAD)
CREATE TABLE ESPECIE_VIVE_HABITAT(
	NOMBRE_CIENTIFICO VARCHAR (50),
    NOMBRE_HABITAT VARCHAR (50),
    INDICE_VULNERABILIDAD TINYINT,
    
    PRIMARY KEY (NOMBRE_CIENTIFICO, NOMBRE_HABITAT),
    
    FOREIGN KEY (NOMBRE_CIENTIFICO) REFERENCES ESPECIE(NOMBRE_CIENTIFICO), 
    FOREIGN KEY (NOMBRE_HABITAT) REFERENCES HABITAT(NOMBRE_HABITAT),
    
	CONSTRAINT VULNERABILIDAD_0_10 CHECK (INDICE_VULNERABILIDAD BETWEEN 0 AND 10)
);


INSERT INTO ESPECIE_VIVE_HABITAT VALUES 
("OSO POLAR", "ESPAÑA", 8),
("OSO NO TAN POLAR", "NO TAN ESPAÑA", 5);

SELECT * FROM ESPECIE_VIVE_HABITAT;