DROP SCHEMA IF EXISTS PTLUIS;
CREATE SCHEMA PTLUIS;
USE PTLUIS;

# PERSONA (ID, NOMBRE, FECHA_NACIMIENTO, FECHA_DEFUNCION)
CREATE TABLE PERSONA (
	ID INT PRIMARY KEY AUTO_INCREMENT,
    NOMBRE VARCHAR (50) NOT NULL, 
    FECHA_NACIMIENTO DATETIME,
    FECHA_DEFUNCION DATETIME
     
);

# FANTASMA (ID, NOMBRE, EDAD, TIPO, DESCRIPCIÓN, ID_CAZAFANTASMA, ID_PERSONA)
CREATE TABLE FANTASMA (
	ID INT PRIMARY KEY AUTO_INCREMENT,
    NOMBRE VARCHAR (50) UNIQUE NOT NULL,
    EDAD INT,
    TIPO VARCHAR (50),
    DESCRIPCION MEDIUMTEXT NOT NULL,
    ID_CAZAFANTASMA INT,
    ID_PERSONA INT,
    
    FOREIGN KEY (ID_CAZAFANTASMA) REFERENCES FANTASMA(ID),    
    FOREIGN KEY (ID_PERSONA) REFERENCES PERSONA(ID),
    
    CONSTRAINT EDAD_0_1000 CHECK (EDAD BETWEEN 1 AND 1000)
);


# GRUPO (ID, NOMBRE, FECHA_FORMACION, FECHA_DISOLUCION, ID_CAZAFANTASMA)
CREATE TABLE GRUPO (
	ID INT PRIMARY KEY AUTO_INCREMENT,
    NOMBRE VARCHAR (50) NOT NULL,
    FECHA_FORMACION DATETIME,
    FECHA_DISOLUCION DATETIME,
    ID_CAZAFANTASMA INT,
    
    FOREIGN KEY (ID_CAZAFANTASMA) REFERENCES FANTASMA(ID), 
    
    CONSTRAINT FECHA_DISOLUCION CHECK (FECHA_DISOLUCION > FECHA_FORMACION)
);

# CAZAFANTASMA (ID, NOMBRE, AÑOS_EXPERIENCIA, ESPECIALIZACION)
CREATE TABLE CAZAFANTASMA (
	ID INT PRIMARY KEY AUTO_INCREMENT,
    NOMBRE VARCHAR (50) NOT NULL, 
    AÑOS_EXPERIENCIA TINYINT,
    ESPECIALIZACION TINYTEXT,
    
    CONSTRAINT AÑOS_EXPERIENCIA_0 CHECK (AÑOS_EXPERIENCIA > 0)
);

# EQUIPO (ID, NOMBRE, DIFICULTAD, FOTO, DESCRIPCIÓN)
CREATE TABLE EQUIPO (
	ID INT PRIMARY KEY AUTO_INCREMENT,
    NOMBRE VARCHAR (50) NOT NULL, 
    DIFIFULTAD VARCHAR (50) DEFAULT "MEDIA",
	FOTO MEDIUMBLOB,
    DESCRIPCION TEXT
);

# GRUPO_INVESTIGA_FANTASMA (ID_GRUPO, ID_FANTASMA)
CREATE TABLE GRUPO_INVESTIGA_FANTASMA (
	ID_GRUPO INT,
	ID_FANTASMA INT,
    
    PRIMARY KEY (ID_GRUPO, ID_FANTASMA),
    
    FOREIGN KEY (ID_GRUPO) REFERENCES GRUPO (ID),
    FOREIGN KEY (ID_FANTASMA) REFERENCES GRUPO (ID)
    
);

# GRUPO_PERTENECE_CAZAFANTASMA (ID_GRUPO, ID_CAZAFANTASMA, FUNCION)
CREATE TABLE GRUPO_PERTENECE_CAZAFANTASMA (
	ID_GRUPO INT,
	ID_CAZAFANTASMA INT,
    FUNCION VARCHAR (50),
    
    
    PRIMARY KEY (ID_GRUPO, ID_CAZAFANTASMA),
    
    FOREIGN KEY (ID_GRUPO) REFERENCES GRUPO (ID),
    FOREIGN KEY (ID_CAZAFANTASMA) REFERENCES CAZAFANTASMA (ID)
);

# CAZAFANTASMA_MANEJA_EQUIPO (ID_CAZAFANTASMA, ID_EQUIPO)
CREATE TABLE CAZAFANTASMA_MANEJA_EQUIPO (
	ID_CAZAFANTASMA INT,
    ID_EQUIPO INT,    
    
    
    PRIMARY KEY (ID_CAZAFANTASMA, ID_EQUIPO),
    
    FOREIGN KEY (ID_CAZAFANTASMA) REFERENCES CAZAFANTASMA (ID),
    FOREIGN KEY (ID_EQUIPO) REFERENCES EQUIPO (ID)
);

# FANTASMA_AVISTA_PERSONA (ID_FANTASMA, ID_PERSONA, LUGAR, FECHA)
CREATE TABLE FANTASMA_AVISTA_PERSONA (
	ID_FANTASMA INT,
	ID_PERSONA INT,
    LUGAR VARCHAR (50),
    FECHA DATETIME,
    
    
    PRIMARY KEY (ID_FANTASMA, ID_PERSONA, FECHA),
    
    FOREIGN KEY (ID_FANTASMA) REFERENCES FANTASMA (ID),
    FOREIGN KEY (ID_PERSONA) REFERENCES PERSONA (ID)
);