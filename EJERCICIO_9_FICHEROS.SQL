DROP SCHEMA IF EXISTS EJERCICIO_9;
CREATE SCHEMA EJERCICIO_9;
USE EJERCICIO_9;

# SECCION (ID_SECCION, NOMBRE, NIF_EMPLEADO)
CREATE TABLE SECCION(
	ID_SECCION INT PRIMARY KEY AUTO_INCREMENT,
    NOMBRE VARCHAR (50),
    NIF_EMPLEADO CHAR (9)
);

INSERT INTO SECCION VALUES 
(1, "LUIS DIRECTOR", NULL);

# EMPLEADO (NIF_EMPLEADO, NOMBRE, APELLIDOS, ID_SECCION)
CREATE TABLE EMPLEADO(
	NIF_EMPLEADO CHAR (9) PRIMARY KEY,
    NOMBRE VARCHAR (50) NOT NULL,
    APELLIDOS VARCHAR (50) NOT NULL,
	ID_SECCION INT NOT NULL,
    
    FOREIGN KEY (ID_SECCION) REFERENCES SECCION (ID_SECCION)    
);

INSERT INTO EMPLEADO VALUES 
("12345678Q", "LUIS", "GARCIA", 1),
("12345678W", "LUIS 2 ", "GARCIA 2", 1);

ALTER TABLE SECCION
ADD CONSTRAINT FOREIGN KEY (NIF_EMPLEADO) REFERENCES EMPLEADO(NIF_EMPLEADO);

# CLIENTE (NIF_CLIENTE, NOMBRE, APELLIDOS, DOMICILIO, CIUDAD, PROVINCIA, TELEFONO)
CREATE TABLE CLIENTE (
	NIF_CLIENTE CHAR (9) PRIMARY KEY,
    NOMBRE VARCHAR (50),
    APELLIDOS VARCHAR (50),
    DOMICILIO VARCHAR (100),
    CIUDAD VARCHAR (50),
	PROVINCIA VARCHAR (50),
    TELEFONO VARCHAR (15) UNIQUE
);

INSERT INTO CLIENTE VALUES
("123456789A", "JUAN", "PEREZ", "SEÃ‘ORA DE LA SALUD", "GRANADA", "GRANADA", "638392272");

# ARTICULO (CODIGO_ARTICULO)
CREATE TABLE ARTICULO (
	CODIGO_ARTICULO INT PRIMARY KEY AUTO_INCREMENT 
);

# CLIENTE_COMPRA_ARTICULO (NIF_CLIENTE, CODIGO_ARTICULO, F_COMPRA, CANTIDAD, NIF_EMPLEADO)
CREATE TABLE CLIENTE_COMPRA_ARTICULO (
	NIF_CLIENTE CHAR (9),
    CODIGO_ARTICULO INT,
    F_COMPRA DATETIME,
    CANTIDAD SMALLINT,
    NIF_EMPLEADO CHAR (9),
    
    PRIMARY KEY (NIF_CLIENTE, CODIGO_ARTICULO, F_COMPRA),
    
    FOREIGN KEY (NIF_CLIENTE) REFERENCES CLIENTE(NIF_CLIENTE),
    FOREIGN KEY (CODIGO_ARTICULO) REFERENCES ARTICULO(CODIGO_ARTICULO),
    FOREIGN KEY (NIF_EMPLEADO) REFERENCES EMPLEADO(NIF_EMPLEADO)
);

# EQUIPO (CODIGO_ARTICULO, STOCK, NOMBRE, DESCRIPCION, PRECIO)
CREATE TABLE EQUIPO (
	CODIGO_ARTICULO INT PRIMARY KEY,
    STOCK SMALLINT,
    NOMBRE VARCHAR (50),
    DESCRIPCION TEXT,
    PRECIO DECIMAL (7,2) DEFAULT 0.00,
    
    FOREIGN KEY (CODIGO_ARTICULO) REFERENCES ARTICULO(CODIGO_ARTICULO)

);

# COMPONENTE (CODIGO_ARTICULO, STOCK, NOMBRE, DESCRIPCION, PRECIO)
CREATE TABLE COMPONENTE (
	CODIGO_ARTICULO INT PRIMARY KEY,
    STOCK SMALLINT,
    NOMBRE VARCHAR (50),
    DESCRIPCION TEXT,
    PRECIO DECIMAL (7,2),
    
    FOREIGN KEY (CODIGO_ARTICULO) REFERENCES ARTICULO(CODIGO_ARTICULO)
);


# EQUIPO_COMPUESTO_COMPONENTE (CODIGO_EQUIPO, CODIGO_COMPONENTE, CANTIDAD)
CREATE TABLE EQUIPO_COMPUESTO_COMPONENTE (
	CODIGO_EQUIPO INT,
    CODIGO_COMPONENTE INT,
    CANTIDAD DECIMAL (7,2),
    
    PRIMARY KEY (CODIGO_EQUIPO, CODIGO_COMPONENTE),
    
    FOREIGN KEY (CODIGO_EQUIPO) REFERENCES EQUIPO(CODIGO_ARTICULO),
    FOREIGN KEY (CODIGO_COMPONENTE) REFERENCES COMPONENTE(CODIGO_ARTICULO)
    
);