DROP SCHEMA IF EXISTS EJERCICIO_11;
CREATE SCHEMA EJERCICIO_11;
USE EJERCICIO_11;


# AEROPUERTO (CODIGO, NOMBRE, CUIDAD, PAIS)
CREATE TABLE AEROPUERTO(
	CODIGO CHAR (3) PRIMARY KEY,
    NOMBRE VARCHAR (50) UNIQUE NOT NULL,
    CIUDAD VARCHAR (50) NOT NULL,
    PAIS VARCHAR (50) NOT NULL
);


# PROGRAMA_VUELO (COMPAÑIA, RUTA, CODIGO_DESPEGA, CODIGO_ATERRIZA)
CREATE TABLE PROGRAMA_VUELO(
	COMPANIA VARCHAR (50) NOT NULL,
    RUTA VARCHAR (50) NOT NULL,
    CODIGO_DESPEGA CHAR(3),
    CODIGO_ATERRIZA CHAR(3),
    
    PRIMARY KEY (COMPANIA, RUTA),
    
    FOREIGN KEY (CODIGO_DESPEGA) REFERENCES AEROPUERTO (CODIGO),
	FOREIGN KEY (CODIGO_ATERRIZA) REFERENCES AEROPUERTO (CODIGO)

);

INSERT INTO PROGRAMA_VUELO VALUES
(DEFAULT, "2023-11-02", 10, "FLY EMIRATES", "GRANADA-MADRID", "BOING747");

# PROGRAMA_VUELO_TIENE_DIA (COMPAÑIA, RUTA, DIA)
CREATE TABLE PROGRAMA_VUELO_TIENE_DIA(
	COMPANIA VARCHAR (50) NOT NULL,
    RUTA VARCHAR (50) NOT NULL,
    DIA VARCHAR (9),
    
    PRIMARY KEY (COMPANIA, RUTA, DIA),
    
    FOREIGN KEY (COMPANIA, RUTA) REFERENCES PROGRAMA_VUELO (COMPANIA, RUTA),
    
    CONSTRAINT DIA_OK CHECK (DIA IN ("LUNES", "MARTES", "MIERCOLES", "JUEVES", "VIERNES","SABADO", "DOMINGO"))
);

# MODELO_AVION (NOMBRE, CAPACIDAD)
CREATE TABLE MODELO_AVION(
	NOMBRE VARCHAR (50) PRIMARY KEY,
    CAPACIDAD SMALLINT NOT NULL,
    CONSTRAINT CAPACIDAD2_200 CHECK (CAPACIDAD BETWEEN 2 AND 200)
);

INSERT INTO MODELO_AVION VALUES
("BOING747", 200); 

# VUELO (NUMERO_VUELO, FECHA, PLAZAS_VACIAS, COMPAÑIA, RUTA, NOMBRE_MODELO)
CREATE TABLE VUELO(
	NUMERO_VUELO INT PRIMARY KEY AUTO_INCREMENT,
    FECHA DATE NOT NULL,
    PLAZAS_VACIAS SMALLINT DEFAULT 10 NOT NULL,
    COMPANIA VARCHAR (50) NOT NULL,
    RUTA VARCHAR (50) NOT NULL,
    NOMBRE_MODELO VARCHAR (50),
    
    FOREIGN KEY (COMPANIA, RUTA) REFERENCES PROGRAMA_VUELO (COMPANIA, RUTA),
	FOREIGN KEY (NOMBRE_MODELO) REFERENCES MODELO_AVION (NOMBRE),
    
    CONSTRAINT FECHA_MAS_1930 CHECK (FECHA > "1930-01-01")
);

INSERT INTO VUELO VALUES
(DEFAULT, "2023-11-02", 10, "FLY EMIRATES", "GRANADA-MADRID", "BOING747");

# MODELO_AVION_PUEDE_ATERRIZAR_AEROPUERTO (NOMBRE, CODIGO)
CREATE TABLE MODELO_AVION_PUEDE_ATERRIZAR_AEROPUERTO (
	NOMBRE_MODELO VARCHAR (50),
    CODIGO_AEROPUERTO CHAR (3),
    
    PRIMARY KEY (NOMBRE_MODELO, CODIGO_AEROPUERTO),
    
    FOREIGN KEY (NOMBRE_MODELO) REFERENCES MODELO_AVION (NOMBRE),
	FOREIGN KEY (CODIGO_AEROPUERTO) REFERENCES AEROPUERTO (CODIGO)

);